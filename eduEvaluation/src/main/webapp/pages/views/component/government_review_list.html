<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>省厅管理员审核</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
</head>
<style>
.noborder td{
border:0;
text-align: left;
}
</style>
<body>

  <div class="layui-fluid">
    <div class="layui-card">

      <div class="layui-form">
     	    	
       		<div class="layui-card-body"  style="width:70%;">  
       		<table class="layui-table" style="border: 1px solid #e6e6e6;">
     	    	<tr class="noborder">
     	    		<td style="width:60px;">填报任务</td><td>
     	    			<select id="task_list" lay-search=""  lay-filter="task_list" id=task_id>
     	    				<option value=""></option>
     	    			</select>
     	    		</td>
     	    		<td style="width:120px;"> </td><td><input type="text" id="year" style="border: 0;background: white;"></td> 
     	    		<td></td><td></td>    	    		
     	    	</tr >
     	    	<tr class="noborder">
     	    		<td style="width:60px;">学校搜索</td><td>
     	    			<select id="school_list" lay-search="" lay-filter="school_list" >
     	    			   	<option value="">直接选择或搜索选择</option>
     	    			</select>
     	    		</td>
     	    		<td style="width:100px;">专业搜索</td><td>
	     	    		<select id="major_list" lay-search="" lay-filter="major_list">
	     	    			<option value="">直接选择或搜索选择</option>
	     	    		</select>
     	    		</td>
     	    		<td style="width:90px;">填报状态搜素</td><td>
	     	    		<select id="status_list" lay-search="" lay-filter="status_list">
	     	    		<option value="">直接选择或搜索选择</option>
	 	    			</select>
 					</td>
     	    	</tr>
     	    </table>		        
            <table  id="demo" class="layui-table"  lay-filter="demo" ></table>
             <script type="text/html" id="test-table-toolbar-barDemo">
 			  {{#  if(d.process_status == 'N' ){ }}
 					 <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="view"  ><svg t="1567675191751" class="icon" style="margin-top:5px;height:12px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2377" width="15" height="15"><path d="M512.3328 206.554112c-303.401984 0-459.177984 305.772544-459.177984 305.772544s117.551104 305.814528 459.177984 305.814528c309.380096 0 459.162624-304.621568 459.162624-304.621568S820.52096 206.554112 512.3328 206.554112zM513.025024 703.459328c-110.930944 0-191.125504-83.627008-191.125504-191.133696 0-107.521024 80.19456-191.118336 191.125504-191.118336 110.926848 0 191.121408 83.596288 191.121408 191.118336C704.146432 619.83232 623.951872 703.459328 513.025024 703.459328zM513.025024 397.6448c-63.398912 0.137216-114.676736 53.246976-114.676736 114.680832 0 61.395968 51.277824 114.680832 114.676736 114.680832 63.398912 0 114.669568-53.284864 114.669568-114.680832C627.694592 450.876416 576.423936 397.522944 513.025024 397.6448z" p-id="2378" fill="#cdcdcd"></path></svg>查看</a>
					 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
              		 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="commit"><i class="layui-icon layui-icon-delete"></i>提交</a>             
              {{#  } else if(d.process_status == 'I' ) { }}
           		 	 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="view"  ><svg t="1567675191751" class="icon" style="margin-top:5px;height:12px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2377" width="15" height="15"><path d="M512.3328 206.554112c-303.401984 0-459.177984 305.772544-459.177984 305.772544s117.551104 305.814528 459.177984 305.814528c309.380096 0 459.162624-304.621568 459.162624-304.621568S820.52096 206.554112 512.3328 206.554112zM513.025024 703.459328c-110.930944 0-191.125504-83.627008-191.125504-191.133696 0-107.521024 80.19456-191.118336 191.125504-191.118336 110.926848 0 191.121408 83.596288 191.121408 191.118336C704.146432 619.83232 623.951872 703.459328 513.025024 703.459328zM513.025024 397.6448c-63.398912 0.137216-114.676736 53.246976-114.676736 114.680832 0 61.395968 51.277824 114.680832 114.676736 114.680832 63.398912 0 114.669568-53.284864 114.669568-114.680832C627.694592 450.876416 576.423936 397.522944 513.025024 397.6448z" p-id="2378" fill="#cdcdcd"></path></svg>查看</a>
					 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
              		 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="commit"><i class="layui-icon layui-icon-delete"></i>提交</a>             
              {{#  } else if(d.process_status == 'S' ) { }}
					 <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="view"><svg t="1567675191751" class="icon" style="margin-top:5px;height:12px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2377" width="15" height="15"><path d="M512.3328 206.554112c-303.401984 0-459.177984 305.772544-459.177984 305.772544s117.551104 305.814528 459.177984 305.814528c309.380096 0 459.162624-304.621568 459.162624-304.621568S820.52096 206.554112 512.3328 206.554112zM513.025024 703.459328c-110.930944 0-191.125504-83.627008-191.125504-191.133696 0-107.521024 80.19456-191.118336 191.125504-191.118336 110.926848 0 191.121408 83.596288 191.121408 191.118336C704.146432 619.83232 623.951872 703.459328 513.025024 703.459328zM513.025024 397.6448c-63.398912 0.137216-114.676736 53.246976-114.676736 114.680832 0 61.395968 51.277824 114.680832 114.676736 114.680832 63.398912 0 114.669568-53.284864 114.669568-114.680832C627.694592 450.876416 576.423936 397.522944 513.025024 397.6448z" p-id="2378" fill="#ffffff"></path></svg>查看</a>
					 <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
              		 <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="commit"><i class="layui-icon layui-icon-delete"></i>提交</a>
			  {{#  } else if(d.process_status == 'R' ) { }}
					  <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="view"  ><svg t="1567675191751" class="icon" style="margin-top:5px;height:12px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2377" width="15" height="15"><path d="M512.3328 206.554112c-303.401984 0-459.177984 305.772544-459.177984 305.772544s117.551104 305.814528 459.177984 305.814528c309.380096 0 459.162624-304.621568 459.162624-304.621568S820.52096 206.554112 512.3328 206.554112zM513.025024 703.459328c-110.930944 0-191.125504-83.627008-191.125504-191.133696 0-107.521024 80.19456-191.118336 191.125504-191.118336 110.926848 0 191.121408 83.596288 191.121408 191.118336C704.146432 619.83232 623.951872 703.459328 513.025024 703.459328zM513.025024 397.6448c-63.398912 0.137216-114.676736 53.246976-114.676736 114.680832 0 61.395968 51.277824 114.680832 114.676736 114.680832 63.398912 0 114.669568-53.284864 114.669568-114.680832C627.694592 450.876416 576.423936 397.522944 513.025024 397.6448z" p-id="2378" fill="#cdcdcd"></path></svg>查看</a>
					 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
              		 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="commit"><i class="layui-icon layui-icon-delete"></i>提交</a>             
 			  {{#  } else if(d.process_status == 'G' ) { }}
			         <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="view"><svg t="1567675191751" class="icon" style="margin-top:5px;height:12px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2377" width="15" height="15"><path d="M512.3328 206.554112c-303.401984 0-459.177984 305.772544-459.177984 305.772544s117.551104 305.814528 459.177984 305.814528c309.380096 0 459.162624-304.621568 459.162624-304.621568S820.52096 206.554112 512.3328 206.554112zM513.025024 703.459328c-110.930944 0-191.125504-83.627008-191.125504-191.133696 0-107.521024 80.19456-191.118336 191.125504-191.118336 110.926848 0 191.121408 83.596288 191.121408 191.118336C704.146432 619.83232 623.951872 703.459328 513.025024 703.459328zM513.025024 397.6448c-63.398912 0.137216-114.676736 53.246976-114.676736 114.680832 0 61.395968 51.277824 114.680832 114.676736 114.680832 63.398912 0 114.669568-53.284864 114.669568-114.680832C627.694592 450.876416 576.423936 397.522944 513.025024 397.6448z" p-id="2378" fill="#ffffff"></path></svg>查看</a>
					 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
              		 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="commit"><i class="layui-icon layui-icon-delete"></i>提交</a> 
 			  {{#  } else if(d.process_status == 'E' ) { }}
					 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="view"  ><svg t="1567675191751" class="icon" style="margin-top:5px;height:12px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2377" width="15" height="15"><path d="M512.3328 206.554112c-303.401984 0-459.177984 305.772544-459.177984 305.772544s117.551104 305.814528 459.177984 305.814528c309.380096 0 459.162624-304.621568 459.162624-304.621568S820.52096 206.554112 512.3328 206.554112zM513.025024 703.459328c-110.930944 0-191.125504-83.627008-191.125504-191.133696 0-107.521024 80.19456-191.118336 191.125504-191.118336 110.926848 0 191.121408 83.596288 191.121408 191.118336C704.146432 619.83232 623.951872 703.459328 513.025024 703.459328zM513.025024 397.6448c-63.398912 0.137216-114.676736 53.246976-114.676736 114.680832 0 61.395968 51.277824 114.680832 114.676736 114.680832 63.398912 0 114.669568-53.284864 114.669568-114.680832C627.694592 450.876416 576.423936 397.522944 513.025024 397.6448z" p-id="2378" fill="#cdcdcd"></path></svg>查看</a>
					 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
              		 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="commit"><i class="layui-icon layui-icon-delete"></i>提交</a>             
 			  {{#  } else if(d.process_status == 'A' ) { }}
					 <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="view"><svg t="1567675191751" class="icon" style="margin-top:5px;height:12px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2377" width="15" height="15"><path d="M512.3328 206.554112c-303.401984 0-459.177984 305.772544-459.177984 305.772544s117.551104 305.814528 459.177984 305.814528c309.380096 0 459.162624-304.621568 459.162624-304.621568S820.52096 206.554112 512.3328 206.554112zM513.025024 703.459328c-110.930944 0-191.125504-83.627008-191.125504-191.133696 0-107.521024 80.19456-191.118336 191.125504-191.118336 110.926848 0 191.121408 83.596288 191.121408 191.118336C704.146432 619.83232 623.951872 703.459328 513.025024 703.459328zM513.025024 397.6448c-63.398912 0.137216-114.676736 53.246976-114.676736 114.680832 0 61.395968 51.277824 114.680832 114.676736 114.680832 63.398912 0 114.669568-53.284864 114.669568-114.680832C627.694592 450.876416 576.423936 397.522944 513.025024 397.6448z" p-id="2378" fill="#ffffff"></path></svg>查看</a>
					 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
              		 <a class="layui-btn layui-btn-disabled layui-btn-xs" lay-event="commit"><i class="layui-icon layui-icon-delete"></i>提交</a> 
			  {{#  } }}
            </script>
	        </div>
    
        </div>      
      </div>
    </div>
  
  


  <script src="../../layuiadmin/layui/layui.js"></script> 
  <script src="../util/Constants.js"></script> 
  <script>
 
  var projectBase = Class.getURL();
  var userinfo = layui.data('userinfo');
  
  layui.config({
	    base: '../../layuiadmin/' //静态资源所在路径
	  }).extend({
	    index: 'lib/index' //主入口模块
	  }).use(['index', 'contlist','element', 'table', 'layer','admin','jquery'],function(){
		  var table = layui.table
		    ,form = layui.form
			,admin = layui.admin
		    ,$ = layui.jquery
		    ,layer = layui.layer;
		  
			  table.render({
			  elem: '#demo'
			  ,height: 500
			  ,url: projectBase + '/userTask/searchTaskList'//数据接口
			  //,toolbar:'#toolbarDemo'
			  ,page: false //开启分页
			  ,cols: [[  //表头
				   {field: 'school_name', title: '院校', align:'center'}
				   ,{field: 'major_name', title: '专业', align:'center'}
				   ,{field: 'status_msg', title: '专业填报状态', align:'center'}
				   //,{field: 'counts', title: '状态更新时间', align:'center'}
				   /*  ,{field: 'process_status', title: '填报状态码', align:'center'} */
				   ,{fixed: 'right', title:'操作',   toolbar: '#test-table-toolbar-barDemo', align:'center'} 
			  ]]
			});  
 
			  
			    table.on('tool(demo)', function(obj){
				  var datas = obj.data;
				  var task_name =  $("#task_list").find("option:selected").text();
				  if(obj.event === 'view'){
					     layui.data('viewTask_top',{
						  key: "taskInfo",
						  value:{"task_id":$('#task_list').val(),"task_name":task_name,"year":$("#year").val(),"school_id":$("#school_list").val(),"major_id":$("#major_list").val()}
						}); 
					    
					     layui.data('viewTask_bot',{
						  key: "taskInfo",
						  value: datas
						 });

						   					  
						//Tap跳转
						parent.layui.index.openTabsPage("component/school_management_review.html", "查看填报任务");
				  }
					 
		      });  
	   
			
			  var schoolid=-1;
			  
			  $.ajax({
					url: projectBase + '/user/userSchool',
					data:{'token' : userinfo['token']},
					dataType:'json',				
					async: false,
					success:function(res){					
						  schoolid =  res.code;
						}
					});
			 
			  //获取任务填报清单
			  $.ajax({
					url: projectBase + '/userTask/schoolTaskList',
					data:{'token' : userinfo['token']},
					dataType:'json',				
					async: false,
					success:function(res){
									if(res.code==0){       
					                       // layer.msg('成功!');
										var task_list = res.data;
										
										$.each(task_list, function (index, item) {
									   		 var opt =  new Option(item.task_name, item.id);    		 		
									   			$('#task_list').append(opt);// 下拉菜单里添加元素   		    			
									   		});
								    	layui.form.render("select");
					                } else {          
					                        layer.msg('任务列表失败!', function(){
															layer.msg('任务列表失败!');
													  });   
					                }
				 					
					},             
					 error:function(data){
						
								layer.msg('任务列表失败!', function(){
									layer.msg('任务列表失败!');
								});  
					  }     
				});
			  	  
		  //获取用户能看到的学校的权限
		  $.ajax({
				url: projectBase + '/dictionary/school',
				dataType:'json',				
				async: false,
				success:function(res){
								if(res.code==0){       
				                       // layer.msg('成功!');
									var school_list = res.data;
									
									$.each(school_list, function (index, item) {
								   		 var opt =  new Option(item.school_name, item.id);    		 		
								   			$('#school_list').append(opt);// 下拉菜单里添加元素   		    			
								   		});
									layui.form.render("select");
 
									//var select = 'dd[lay-value=' + schoolid + ']';  	
							   		//$('#school_list').siblings("div.layui-form-select").find('dl').find(select).click();
									
							    	
				                } else {          
				                        layer.msg('学校列表失败!', function(){
														layer.msg('学校列表失败!');
												  });   
				                }
			 					
				},             
				 error:function(data){
					
							layer.msg('学校列表失败!', function(){
								layer.msg('学校列表失败!');
							});  
				  }     
			});
		  
		  //$('#school_list').attr("disabled",true); 
		   //获取专业列表
		  $.ajax({
				url: projectBase + '/dictionary/major',
				data:{'token' : userinfo['token']},
				dataType:'json',				
				async: false,
				success:function(res){
								if(res.code==0){       
				                        //layer.msg('成功!');
									var major_list = res.data;
									
									$.each(major_list, function (index, item) {
								   		 var opt =  new Option(item.majorName, item.id);    		 		
								   			$('#major_list').append(opt);// 下拉菜单里添加元素   		    			
								   		});
							    	layui.form.render("select");
								
				                } else {          
				                        layer.msg('专业列表失败!', function(){
														layer.msg('专业列表失败!');
												  });   
				                }
			 
				
				},             
				 error:function(data){
					
							layer.msg('专业列表失败!', function(){
								layer.msg('专业列表失败!');
							});  
				  }     
			});
		  
		  //获取状态列表
		  $.ajax({
				url: projectBase + '/collection/status',
				data:{'token' : userinfo['token']},
				dataType:'json',				
				async: false,
				success:function(res){
								if(res.code==0){       
				                    //layer.msg('成功!');
									var status_list = res.data;
									
									$.each(status_list, function (index, item) {
								   		 var opt =  new Option(item.msg, item.status_string);    		 		
								   			$('#status_list').append(opt);// 下拉菜单里添加元素   		    			
								   		});
							    	layui.form.render("select");
				                } else {          
				                        layer.msg('状态列表失败!', function(){
														layer.msg('状态列表失败!');
												  });   
				                }
			 
				},             
				 error:function(data){					
							layer.msg('状态列表失败!', function(){
								layer.msg('状态列表失败!');
							});  
				  }     
			});
		  
		  
		  //监听任务change事件
		  form.on('select(task_list)', function(data){
			    table.reload('demo', {
			        where: {"task_id":$("#task_list").val(),"school_id":$("#school_list").val(),
			        		"major_id":$("#major_list").val(),"process_status":$("#status_list").val()}
			      });  		 
		 }); 
		 form.on('select(school_list)', function(data){
			    table.reload('demo', {
			        where: {"task_id":$("#task_list").val(),"school_id":$("#school_list").val(),
			        		"major_id":$("#major_list").val(),"process_status":$("#status_list").val()}
			      });  		 
		 }); 
		  
		  form.on('select(major_list)', function(data){
			    table.reload('demo', {
			        where: {"task_id":$("#task_list").val(),"school_id":$("#school_list").val(),
			        		"major_id":$("#major_list").val(),"process_status":$("#status_list").val()}
			      });  		 
		 });
		  form.on('select(status_list)', function(data){
			    table.reload('demo', {
			        where: {"task_id":$("#task_list").val(),"school_id":$("#school_list").val(),
			        		"major_id":$("#major_list").val(),"process_status":$("#status_list").val()}
			      });  		 
		 });
		  
		
 	 
		  
		  table.reload('demo', {
		        where: {"task_id":$("#task_list").val(),"school_id":$("#school_list").val(),
		        		"major_id":$("#major_list").val(),"process_status":$("#status_list").val()}
		      });
		 
		  
		
	  });
   
 
  </script>
</body>
</html>
